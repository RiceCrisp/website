{"version":3,"sources":["admin/pagebuilder.js","admin/_pb-section.js","admin/_pb-module.js"],"names":["updateOrder","c","jQuery","each","index","this","find","wp","editor","remove","id","oldId","attr","replace","oldName","oldFor","index2","match","oldTarget","initialize","tinymce","quicktags","wpColorPicker","length","toggle","document","on","e","preventDefault","is","html","before","parents","hide","unbind","css","ready","ajax","context","url","pbInfo","ajax_url","method","data","action","success","res","append","after","focus","section_name","section_json","val","el","type","checked","value","length2","el2","slice","section","show","parent","children","toggleClass","siblings","slideToggle","next","sortable","axis","handle","cursor","placeholder","forcePlaceholderSize","stop","ui","sectionId","bind","module","prompt","sel","removeClass","addClass"],"mappings":"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","file":"pagebuilder.min.js","sourcesContent":["// Page builder toggle\nif (jQuery('ul#sections > li').length) {\n  jQuery('#postdivrich, #page-builder').toggle();\n}\njQuery(document).on('click', '#page-builder-btn', function(e) {\n  e.preventDefault();\n  jQuery('#postdivrich, #page-builder').toggle();\n  if (jQuery('#page-builder').is(':visible')) {\n    jQuery('#page-builder-btn').html('<span class=\"dashicons dashicons-text\"></span>Switch to Editor');\n  } else {\n    jQuery('#page-builder-btn').html('<span class=\"dashicons dashicons-hammer\"></span>Switch to Page Builder');\n  }\n});\nif (jQuery('#page-builder').is(':visible')) {\n  jQuery('#postdivrich').before('<button id=\"page-builder-btn\" class=\"button\"><span class=\"dashicons dashicons-text\"></span>Switch to Editor</button>');\n} else {\n  jQuery('#postdivrich').before('<button id=\"page-builder-btn\" class=\"button\"><span class=\"dashicons dashicons-hammer\"></span>Switch to Page Builder</button>');\n}\n\n// Close lightbox if cancelled\njQuery(document).on('click', '.lightbox-cancel', function(e) {\n  e.preventDefault();\n  jQuery(this).parents('.lightbox').hide();\n  jQuery(this).parents('.lightbox:not(#module-choices)').remove();\n  jQuery('.module-choice button').unbind();\n});\njQuery('#module-choices').css('display', 'flex').hide();\n\n// Update sortable order (we add a tilde so that no fields share the same id at any single moment)\nfunction updateOrder() {\n  // Update sections\n  var c = 0;\n  jQuery('ul#sections > li').each(function(index) {\n    // We want to remove wp.editor fields first before their ids change\n    jQuery(this).find('.text-editor').each(function() {\n      wp.editor.remove(this.id);\n    });\n    if (oldId = this.id) {\n      jQuery(this).attr('id', oldId.replace(/\\d+/g, '~'+index));\n    }\n    jQuery(this).find('.section-options input, .section-options select, .section-options label').each(function() {\n      if (oldId = this.id) {\n        jQuery(this).attr('id', oldId.replace(/\\d+/g, '~'+index));\n      }\n      if (oldName = jQuery(this).attr('name')) {\n        jQuery(this).attr('name', oldName.replace(/\\d+/g, '~'+index));\n      }\n      if (oldFor = jQuery(this).attr('for')) {\n        jQuery(this).attr('for', oldFor.replace(/\\d+/g, '~'+index));\n      }\n    });\n    // Update modules\n    jQuery(this).find('.module').each(function(index2) {\n      jQuery(this).find('input, textarea, select, label').each(function() {\n        if (oldId = this.id) {\n          c = 0;\n          jQuery(this).attr('id', oldId.replace(/\\d+/g, function(match) {\n            c++;\n            return c==1 ? '~'+index : c==2 ? '~'+index2 : '~'+match;\n          }));\n        }\n        if (oldName = jQuery(this).attr('name')) {\n          c = 0;\n          jQuery(this).attr('name', oldName.replace(/\\d+/g, function(match) {\n            c++;\n            return c==1 ? '~'+index : c==2 ? '~'+index2 : '~'+match;\n          }));\n        }\n        if (oldFor = jQuery(this).attr('for')) {\n          c = 0;\n          jQuery(this).attr('for', oldFor.replace(/\\d+/g, function(match) {\n            c++;\n            return c==1 ? '~'+index : c==2 ? '~'+index2 : '~'+match;\n          }));\n        }\n      });\n      jQuery(this).find('.media-selector').each(function() {\n        if (oldTarget = jQuery(this).attr('target')) {\n          c = 0;\n          jQuery(this).attr('target', oldTarget.replace(/\\d+/g, function(match) {\n            c++;\n            return c==1 ? '~'+index : c==2 ? '~'+index2 : '~'+match;\n          }));\n        }\n      });\n    });\n  });\n  // Remove all tildes\n  jQuery('ul#sections > li').each(function(index) {\n    if (oldId = this.id) {\n      jQuery(this).attr('id', oldId.replace(/~/g, ''));\n    }\n    jQuery(this).find('.section-options input, .section-options select, .section-options label').each(function() {\n      if (oldId = this.id) {\n        jQuery(this).attr('id', oldId.replace(/~/g, ''));\n      }\n      if (oldName = jQuery(this).attr('name')) {\n        jQuery(this).attr('name', oldName.replace(/~/g, ''));\n      }\n      if (oldFor = jQuery(this).attr('for')) {\n        jQuery(this).attr('for', oldFor.replace(/~/g, ''));\n      }\n    });\n    // Update modules\n    jQuery(this).find('.module').each(function(index2) {\n      jQuery(this).find('input, textarea, select, label').each(function() {\n        if (oldId = this.id) {\n          jQuery(this).attr('id', oldId.replace(/~/g, ''));\n        }\n        if (oldName = jQuery(this).attr('name')) {\n          jQuery(this).attr('name', oldName.replace(/~/g, ''));\n        }\n        if (oldFor = jQuery(this).attr('for')) {\n          jQuery(this).attr('for', oldFor.replace(/~/g, ''));\n        }\n      });\n      jQuery(this).find('.media-selector').each(function() {\n        if (oldTarget = jQuery(this).attr('target')) {\n          jQuery(this).attr('target', oldTarget.replace(/~/g, ''));\n        }\n      });\n      jQuery(this).find('.text-editor').each(function() {\n        wp.editor.initialize(this.id, {\n          tinymce: true,\n          quicktags: true\n        });\n      });\n    });\n  });\n  jQuery('.color-picker').wpColorPicker();\n}\n\njQuery(document).ready(function() {\n  updateOrder();\n});\n\n//=include _pb-section.js\n//=include _pb-module.js\n","// Add section\njQuery('#add-section').on('click', function(e) {\n  e.preventDefault();\n  jQuery.ajax({\n    context: this,\n    url: pbInfo.ajax_url,\n    method: 'get',\n    data: {\n      action: 'empty_section'\n    },\n    success: function(res) {\n      jQuery('#sections').append(res);\n      updateOrder();\n    }\n  });\n});\n\n// Save section\njQuery(document).on('click', '.section-save', function(e) {\n  e.preventDefault();\n  jQuery(this).after(\n    '<div id=\"section-save\" class=\"lightbox\">'+\n    '<div class=\"postbox\">'+\n    '<div class=\"lightbox-header\">'+\n    '<h2 class=\"lightbox-title\">Save Section?</h2>'+\n    '<button class=\"lightbox-cancel\"><span class=\"dashicons dashicons-no-alt\"></span></button>'+\n    '</div>'+\n    '<div class=\"inside\">'+\n    '<input type=\"text\" id=\"save-name\" placeholder=\"Save Name\" />'+\n    '<div id=\"save-warning\"><i>A saved section already exists with that name.</i></div>'+\n    '<div class=\"choices\">'+\n    '<button class=\"button lightbox-cancel\">Cancel</button>'+\n    '<button class=\"button section-save-confirm\">Save</button>'+\n    '</div>'+\n    '</div>'+\n    '</div>'+\n    '</div>'\n    );\n  jQuery('#save-name').focus();\n\n\n  jQuery(document).on('click', '.section-save-confirm', function(e) {\n    e.preventDefault();\n    var section_name = jQuery(this).parents('.lightbox').find('#save-name');\n    var section_json = '{\"section-name\": \"' + section_name.val() + '\"';\n    // Section\n    jQuery(this).parents('.section').find('.section-options input:not([type=button]), .section-options select').each(function(index, el) {\n      section_json += ', \"' + el.id.replace(/-\\d+/g, '') + '\": ';\n      if (el.type == 'checkbox') {\n        section_json += el.checked;\n      } else {\n        section_json += '\"' + el.value + '\"';\n      }\n    });\n    // Modules\n    section_json += ', \"modules\": [';\n    var length = jQuery(this).parents('.section').find('.module').length;\n    jQuery(this).parents('.section').find('.module').each(function(index, el) {\n      section_json += '{';\n      var length2 = jQuery(this).find('input:not([type=button]), textarea, select').length;\n      jQuery(this).find('input:not([type=button]), textarea, select').each(function(index2, el2) {\n        section_json += '\"' + el2.id.replace(/-\\d+/g, '') + '\":';\n        if (el2.type == 'checkbox') {\n          section_json += el2.checked + ',';\n        } else {\n          section_json += '\"' + el2.value + '\",';\n        }\n        if (index2 == length2-1) {\n          section_json = section_json.slice(0, -1);\n        }\n      });\n      section_json += '},';\n      if (index == length-1) {\n        section_json = section_json.slice(0, -1);\n      }\n    });\n    section_json += ']}';\n    jQuery.ajax({\n      context: this,\n      url: pbInfo.ajax_url,\n      method: 'post',\n      data: {\n        action: 'save_section',\n        section: section_json\n      },\n      success: function(res) {\n        if (res=='err') {\n          jQuery('#save-name').css('border-color', '#f66');\n          jQuery('#save-warning').show();\n        } else {\n          jQuery(this).parents('.lightbox').remove();\n        }\n      }\n    });\n  });\n});\n\n// Load section\njQuery('#load-section').on('click', function(e) {\n  e.preventDefault();\n  jQuery.ajax({\n    context: this,\n    url: pbInfo.ajax_url,\n    method: 'get',\n    data: {\n      action: 'get_sections'\n    },\n    success: function(res) {\n      jQuery(this).after(\n        '<div id=\"section-load\" class=\"lightbox\">'+\n        '<div class=\"postbox\">'+\n        '<div class=\"lightbox-header\">'+\n        '<h2 class=\"lightbox-title\">Saved Sections</h2>'+\n        '<button class=\"lightbox-cancel\"><span class=\"dashicons dashicons-no-alt\"></span></button>'+\n        '</div>'+\n        '<div class=\"inside\">'+\n        res+\n        '</div>'+\n        '</div>'+\n        '</div>'\n      );\n    }\n  });\n});\njQuery(document).on('click', '.saved-sections li button', function(e) {\n  e.preventDefault();\n  jQuery.ajax({\n    context: this,\n    url: pbInfo.ajax_url,\n    method: 'get',\n    data: {\n      action: 'load_section',\n      section: jQuery(this).parent().attr('index')\n    },\n    success: function(res) {\n      jQuery('#sections').append(res);\n      updateOrder();\n      jQuery(this).parents('.lightbox').remove();\n    }\n  });\n});\njQuery(document).on('click', '.saved-sections li a', function(e) {\n  e.preventDefault();\n  jQuery.ajax({\n    context: this,\n    url: pbInfo.ajax_url,\n    method: 'post',\n    data: {\n      action: 'delete_section',\n      section: jQuery(this).parent().attr('index')\n    },\n    success: function(res) {\n      jQuery(this).parent().remove();\n    }\n  });\n});\n\n// Delete section\njQuery(document).on('click', '.section-delete', function(e) {\n  e.preventDefault();\n  jQuery(this).after(\n    '<div id=\"section-save\" class=\"lightbox\">'+\n      '<div class=\"postbox\">'+\n        '<div class=\"lightbox-header\">'+\n          '<h2 class=\"lightbox-title\">Delete Section?</h2>'+\n          '<button class=\"lightbox-cancel\"><span class=\"dashicons dashicons-no-alt\"></span></button>'+\n        '</div>'+\n        '<div class=\"inside\">'+\n          '<div class=\"choices\">'+\n            '<button class=\"button lightbox-cancel\">Cancel</button>'+\n            '<button class=\"button section-delete-confirm\">Delete</button>'+\n          '</div>'+\n        '</div>'+\n      '</div>'+\n    '</div>'\n  );\n  jQuery(document).on('click', '.section-delete-confirm', function() {\n    var section = jQuery(this).parents('.section');\n    section.find('.text-editor').each(function() {\n      wp.editor.remove(this.id);\n    });\n    section.remove();\n    updateOrder();\n  });\n});\n\n// Collapse section\njQuery(document).on('click', '.section-collapse', function(e) {\n  e.preventDefault();\n  jQuery(this).children().toggleClass('flip');\n  jQuery(this).parents('.section-header').siblings('.section-inside').slideToggle();\n});\n\n// Section options\njQuery(document).on('click', '.section-settings', function(e) {\n  e.preventDefault();\n  jQuery(this).parents('.section-header').next().slideToggle();\n});\n\n// Make sections sortable\njQuery('#sections').sortable({\n  axis: 'y',\n  handle: '.section-handle',\n  cursor: 'ns-resize',\n  placeholder: 'sortable-placeholder',\n  forcePlaceholderSize: true,\n  stop: function(e, ui) {\n    updateOrder();\n  }\n});\n\n// Build module slots\njQuery('#sections').on('change', '.section-options select', function() {\n  if (jQuery(this).val()=='one') {\n    jQuery(this).parents('.section').find('.section-inside .modules').html('<li class=\"module-slot col-xs-12\"><div class=\"add-module\"><span class=\"dashicons dashicons-plus-alt\"></span><span class=\"add-module-text\">Add Module</span></div></li>');\n  } else if (jQuery(this).val()=='halves') {\n    jQuery(this).parents('.section').find('.section-inside .modules').html('<li class=\"module-slot col-xs-6\"><div class=\"add-module\"><span class=\"dashicons dashicons-plus-alt\"></span><span class=\"add-module-text\">Add Module</span></div></li><li class=\"module-slot col-xs-6\"><div class=\"add-module\"><span class=\"dashicons dashicons-plus-alt\"></span><span class=\"add-module-text\">Add Module</span></div></li>');\n  } else if (jQuery(this).val()=='one-third') {\n    jQuery(this).parents('.section').find('.section-inside .modules').html('<li class=\"module-slot col-xs-4\"><div class=\"add-module\"><span class=\"dashicons dashicons-plus-alt\"></span><span class=\"add-module-text\">Add Module</span></div></li><li class=\"module-slot col-xs-8\"><div class=\"add-module\"><span class=\"dashicons dashicons-plus-alt\"></span><span class=\"add-module-text\">Add Module</span></div></li>');\n  } else if (jQuery(this).val()=='two-thirds') {\n    jQuery(this).parents('.section').find('.section-inside .modules').html('<li class=\"module-slot col-xs-8\"><div class=\"add-module\"><span class=\"dashicons dashicons-plus-alt\"></span><span class=\"add-module-text\">Add Module</span></div></li><li class=\"module-slot col-xs-4\"><div class=\"add-module\"><span class=\"dashicons dashicons-plus-alt\"></span><span class=\"add-module-text\">Add Module</span></div></li>');\n  } else {\n    jQuery(this).parents('.section').find('.section-inside .modules').html('<li class=\"module-slot col-xs-4\"><div class=\"add-module\"><span class=\"dashicons dashicons-plus-alt\"></span><span class=\"add-module-text\">Add Module</span></div></li><li class=\"module-slot col-xs-4\"><div class=\"add-module\"><span class=\"dashicons dashicons-plus-alt\"></span><span class=\"add-module-text\">Add Module</span></div></li><li class=\"module-slot col-xs-4\"><div class=\"add-module\"><span class=\"dashicons dashicons-plus-alt\"></span><span class=\"add-module-text\">Add Module</span></div></li>');\n  }\n});\n","// Add module\njQuery(document).on('click', '.add-module', function(e) {\n  e.preventDefault();\n  var sectionId = jQuery(this).parents('.module-slot');\n  jQuery('#module-choices').show(0, function() {\n    jQuery('.module-choice').bind('click', function(e) {\n      e.preventDefault();\n      jQuery.ajax({\n        context: this,\n        url: pbInfo.ajax_url,\n        method: 'get',\n        data: {\n          action: 'empty_module',\n          module: jQuery(this).attr('module')\n        },\n        success: function(res) {\n          jQuery(sectionId).html(res);\n          jQuery('#module-choices').hide();\n          jQuery('.modules').sortable({\n            axis: 'x',\n            handle: '.module-handle',\n            cursor: 'ew-resize',\n            placeholder: 'sortable-placeholder',\n            forcePlaceholderSize: true,\n            stop: function(e, ui) {\n              updateOrder();\n            }\n          });\n          jQuery('.module-choice').unbind();\n          updateOrder();\n        }\n      });\n      // jQuery('#module-choices').hide();\n      // jQuery('.modules').sortable({\n      //   axis: 'x',\n      //   handle: '.module-handle',\n      //   cursor: 'ew-resize',\n      //   placeholder: 'sortable-placeholder',\n      //   forcePlaceholderSize: true,\n      //   stop: function(e, ui) {\n      //     updateOrder();\n      //   }\n      // });\n      // updateOrder();\n      // jQuery('.module-choice').unbind();\n    });\n  });\n});\n\n// Save module\njQuery(document).on('click', '.module-save', function(e) {\n  e.preventDefault();\n  var filename = prompt('What would you like to save this module as?');\n});\n\n// Delete module\njQuery(document).on('click', '.module-delete', function(e) {\n  e.preventDefault();\n  jQuery(this).after(\n    '<div id=\"module-delete\" class=\"lightbox\">'+\n      '<div class=\"postbox\">'+\n        '<div class=\"lightbox-header\">'+\n          '<h2 class=\"lightbox-title\">Delete Module?</h2>'+\n          '<button class=\"lightbox-cancel\"><span class=\"dashicons dashicons-no-alt\"></span></button>'+\n        '</div>'+\n        '<div class=\"inside\">'+\n          '<div class=\"choices\">'+\n            '<button class=\"button lightbox-cancel\">Cancel</button>'+\n            '<button class=\"button module-delete-confirm\">Delete</button>'+\n          '</div>'+\n        '</div>'+\n      '</div>'+\n    '</div>'\n  );\n  jQuery(document).on('click', '.module-delete-confirm', function() {\n    var module = jQuery(this).parents('.module-slot');\n    module.find('.text-editor').each(function() {\n      wp.editor.remove(this.id);\n    });\n    module.html('<div class=\"add-module\"><span class=\"dashicons dashicons-plus-alt\"></span><span class=\"add-module-text\">Add Module</span></div>');\n    updateOrder();\n  });\n});\n\n// Switch between module tabs\njQuery(document).on('click', '.module-tab', function(e) {\n  var sel = jQuery(this).attr('sel');\n  jQuery(this).siblings().removeClass('current');\n  jQuery(this).addClass('current');\n  jQuery(this).parent().parent().next().children().hide();\n  jQuery(this).parent().parent().next().children('.'+sel).show();\n});\n\n// Video module\njQuery(document).on('change', '.video-type-sel', function() {\n  var sel = '.' + jQuery(this).val();\n  jQuery(this).parents('ul').find('.video-type').hide();\n  jQuery(this).parents('ul').find(sel).show();\n});\njQuery('.video-type-sel').each(function() {\n  var sel = '.' + jQuery(this).val();\n  jQuery(this).parents('ul').find('.video-type').hide();\n  jQuery(this).parents('ul').find(sel).show();\n});\n\n// Make modules sortable\n// jQuery('.modules').sortable({\n//   axis: 'x',\n//   handle: '.module-handle',\n//   cursor: 'ew-resize',\n//   placeholder: 'sortable-placeholder',\n//   forcePlaceholderSize: true,\n//   stop: function(e, ui) {\n//     updateOrder();\n//   }\n// });\n"]}